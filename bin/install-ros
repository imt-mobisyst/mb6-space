#!/bin/bash

if ! [ -n "${ROS_DISTRO+set}" ];
then
    ROS_DISTRO=jazzy
fi

echo "
                    --- Set-up Ros-Repos and dependancies ---
"

# Prepare for ROS2 :
sudo apt install -y curl software-properties-common
sudo add-apt-repository universe -y

# Configure apt :
export ROS_APT_SOURCE_VERSION=$(curl -s https://api.github.com/repos/ros-infrastructure/ros-apt-source/releases/latest | grep -F "tag_name" | awk -F\" '{print $4}')
curl -L -o /tmp/ros2-apt-source.deb "https://github.com/ros-infrastructure/ros-apt-source/releases/download/${ROS_APT_SOURCE_VERSION}/ros2-apt-source_${ROS_APT_SOURCE_VERSION}.$(. /etc/os-release && echo ${UBUNTU_CODENAME:-${VERSION_CODENAME}})_all.deb"
sudo dpkg -i /tmp/ros2-apt-source.deb

# A final tool:
sudo apt update
sudo apt install -y ros-dev-tools

echo "
                    --- Install ROS $ROS_DISTRO base ---
"

sudo apt install -y ros-$ROS_DISTRO-ros-base
sudo usermod -a -G dialout `whoami`
